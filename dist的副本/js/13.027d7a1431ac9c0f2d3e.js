webpackJsonp([13],{"44wq":function(t,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var e=s("gRE1"),i=s.n(e),n=s("mvHQ"),l=s.n(n),c=s("Xxa5"),r=s.n(c),_=s("exGp"),o=s.n(_),p={data:function(){return{isShow:!0,temp_arr:[],phaseTraffic:[],cameraData:[],index:"",t:"",currentPage:1,pagesize:20,checklabel:!0,fixedplan_list:[{plan_num:"1",plan_name:"2",part_count:"3",time:"4",status:"6",create_at:"7",update_at:"8"}],editFormVisible:!1,edit_data:{fixedplan_id:"",plan_name:"",plan_num:""},dialogTableVisible:!1,dialogFormVisible:!1,form:{name:"",region:"",date1:"",date2:"",delivery:!1,type:[],resource:"",desc:""},add_list:{green_time:0,yellow_time:0,red_time:0},formLabelWidth:"120px",checkList:[],cityOptions:[]}},computed:{direct:function(){return this.cityOptions}},mounted:function(){this.initial()},methods:{initial:function(){var t=this;return o()(r.a.mark(function a(){var s,e,i;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$http.get("/fixedplanlist/");case 2:s=a.sent,e=s.code,(i=s.data).fixedplan_list.map(function(t){1===t.status?t.status="使用中":t.status="未使用"}),200===e&&(t.fixedplan_list=i.fixedplan_list,t.$cookies.set("row",""),t.$cookies.set("index",""));case 6:case"end":return a.stop()}},a,t)}))()},indexMethod:function(t){return 2*t},handleSizeChange:function(t){this.pagesize=t},handleCurrentChange:function(t){this.currentPage=t},scheme_view:function(t,a){this.$router.push({name:"statusdetail",params:{index:t,row:a}})},add_plan:function(){if(16===this.fixedplan_list.length)return this.$message.error("方案数量已达上限，系统最多可配置16个方案！");localStorage.setItem("row",-1),localStorage.setItem("index",-1);var t=[];this.fixedplan_list.sort(function(t,a){return t.plan_num-a.plan_num}).filter(function(a,s){a.plan_num!==s+1&&t.push(s+1)});var a={plan_num:0===t.length?this.fixedplan_list.length+1:t[0]};localStorage.setItem("row",l()(a)),this.$router.push({name:"fixededit"})},scheme_edit:function(t,a){var s=this;return"使用中"===a.status?this.$message.error("当前方案正在执行，无法编辑"):2===a.type||1===a.dynamic_status?this.$message.error("此方案供策略使用，请取消关联后修改！"):void this.$http({method:"get",url:"fixedplaninfo/"+a.id+"/"}).then(function(a){var e=a.code,i=a.data;200===e&&(localStorage.setItem("row",l()(i)),localStorage.setItem("index",l()(t)),s.$router.push({name:"fixededit"}))})},handleDelete:function(t,a,s){var e=this;return"使用中"===a.status?this.$message.error("当前方案正在执行，无法删除"):2===a.type||1===a.dynamic_status?this.$message.error("此方案供策略使用，请取消关联后修改！"):void this.$confirm("是否要删除该方案?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$http({method:"delete",url:"delfixedplan/"+a.id+"/"}).then(function(t){200===t.code&&e.initial()})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},handleAdd:function(t,a){var s=this;return o()(r.a.mark(function t(){return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s.add_list.green_time=0,s.add_list.red_time=0,s.add_list.yellow_time=0,s.add_list.fixedplan_id=a.id,s.add_list.plan_name=a.plan_name,s.add_list.plan_num=a.plan_num,s.add_list.part_num=a.part_count+1,s.dialogFormVisible=!0,s.getphaselist(),s.temp_arr=[];case 10:case"end":return t.stop()}},t,s)}))()},getphaselist:function(){var t=this;this.$http({method:"get",url:"phaselist/"}).then(function(a){if(200===a.code){var s=a.data.phase_list;t.cityOptions=s;for(var e=0;e<t.cityOptions.length;e++)t.cityOptions[e].judge=!1,t.cityOptions[e].checked=!1;t.phaseTraffic=s}})},getPhaseList:function(){var t=document.querySelectorAll(".phase_img"),a=document.querySelectorAll(".foot_way_img"),s=[],e={};return i()(t).map(function(t){i()(t.children).reverse().map(function(t){s.push(t)})}),i()(a).map(function(t){s.push(t)}),e.phaseArr=s,e},get_listcont:function(t){for(var a=[],s=0;s<t.length;s++)a.push(t[s].id);return a},addfixedpart:function(){var t=this;return o()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.add_list.phase_ids=l()(t.get_listcont(t.checkList)),t.checklist=[],a.next=4,t.$http.post("addfixedpart/",t.add_list);case 4:200===a.sent.code&&(t.dialogFormVisible=!1,t.initial());case 6:case"end":return a.stop()}},a,t)}))()},handlecheckListChange:function(t){var a=t.length;this.checklabel=a>0&&a<this.direct.length},chosen:function(t,a){t.checked=!t.checked;var s=[];if(t.fightinfo.length>0)for(var e=0;e<t.fightinfo.length;e++)s.push(t.fightinfo[e].id);this.revise_pro(s,t.checked,a)},revise_pro:function(t,a,s){if(!1===a){var e=this.temp_arr.indexOf(s);e>-1&&this.temp_arr.splice(e,1)}else this.temp_arr.push(s);if(!1===a)for(var i=0;i<t.length;i++){this.cityOptions;for(var n=0;n<this.cityOptions.length;n++)t[i]===this.cityOptions[n].id&&(!1===this.cityOptions[n].judge?this.cityOptions[n].judge=!0:this.cityOptions[n].judge=!1)}else for(var l=0;l<t.length;l++){this.cityOptions;for(var c=0;c<this.cityOptions.length;c++)t[l]===this.cityOptions[c].id&&(this.cityOptions[c].judge,this.cityOptions[c].judge=!0)}}}},d={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"fixedcontrol"},[e("div",{staticClass:"tit",staticStyle:{display:"flex"}},[e("em",{staticClass:"table-title",staticStyle:{display:"inline-block",flex:"1"}},[t._v("\n      固定方案管理\n    ")]),t._v(" "),t.isShow?e("span",{staticStyle:{cursor:"pointer",color:"#409EFF"},on:{click:function(a){return t.add_plan()}}},[t._v("\n      新增方案\n    ")]):t._e()]),t._v(" "),e("el-card",{attrs:{shadow:"always"}},[e("el-table",{staticClass:"device-info",staticStyle:{width:"100%"},attrs:{data:t.fixedplan_list.slice((t.currentPage-1)*t.pagesize,t.currentPage*t.pagesize),"header-cell-style":{background:"#FAFAFA"},type:"index",index:t.indexMethod,"default-sort":{prop:"plan_num",order:"ascending"}}},[e("el-table-column",{attrs:{label:"方案编号",prop:"plan_num",align:"center","show-overflow-tooltip":""}}),t._v(" "),e("el-table-column",{attrs:{label:"方案名称",prop:"plan_name",align:"center","show-overflow-tooltip":""}}),t._v(" "),e("el-table-column",{attrs:{label:"阶段数",prop:"part_count",align:"center","show-overflow-tooltip":""}}),t._v(" "),e("el-table-column",{attrs:{label:"总周期时长(秒)",prop:"time",align:"center","show-overflow-tooltip":""}}),t._v(" "),e("el-table-column",{attrs:{label:"状态",prop:"status",align:"center","show-overflow-tooltip":""}}),t._v(" "),t.isShow?e("el-table-column",{attrs:{label:"创建时间",prop:"create_at",align:"center","show-overflow-tooltip":""}}):t._e(),t._v(" "),t.isShow?e("el-table-column",{attrs:{label:"更新时间",prop:"update_at",align:"center","show-overflow-tooltip":""}}):t._e(),t._v(" "),e("el-table-column",{attrs:{label:"操作",align:"center",width:"230px"},scopedSlots:t._u([{key:"default",fn:function(a){return[t.isShow?e("el-button",{attrs:{type:"text"},on:{click:function(s){return t.scheme_edit(a.$index,a.row)}}},[t._v("编辑")]):t._e(),t._v(" "),t.isShow?e("el-button",{attrs:{type:"text"},on:{click:function(s){return t.handleDelete(a.$index,a.row,t.fixedplan_list)}}},[t._v("删除")]):t._e(),t._v(" "),e("el-button",{attrs:{type:"text"},on:{click:function(s){return t.scheme_view(a.$index,a.row)}}},[t._v("查看")]),t._v(" "),e("el-dialog",{staticClass:"add_stage",attrs:{align:"left",title:"新增阶段",width:"900px","close-on-click-modal":!1,visible:t.dialogFormVisible},on:{"update:visible":function(a){t.dialogFormVisible=a}}},[e("el-row",{staticClass:"add_plan"},[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"grid-content bg-purple"},[t._v("\n                  方案号："+t._s(t.add_list.plan_num)+"\n                ")])]),t._v(" "),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"grid-content bg-purple-light"},[t._v("\n                  方案名称："+t._s(t.add_list.plan_name)+"\n                ")])]),t._v(" "),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"grid-content bg-purple"},[t._v("\n                  阶段号："+t._s(t.add_list.part_num)+"\n                ")])])],1),t._v(" "),e("div",{staticClass:"set_time"},[t._v("时间设置")]),t._v(" "),e("el-row",{staticClass:"plan_content"},[e("el-col",{attrs:{span:12}},[e("div",{staticClass:"grid-content bg-purple"},[e("el-col",{attrs:{span:24}},[e("div",{staticClass:"grid-content bg-purple che_light"},[t._v("\n                      阶段绿灯时间  \n                      "),e("el-input-number",{attrs:{size:"small","controls-position":"right",min:0,max:255},model:{value:t.add_list.green_time,callback:function(a){t.$set(t.add_list,"green_time",a)},expression:"add_list.green_time"}}),t._v(" 秒\n                    ")],1)]),t._v(" "),e("el-col",{attrs:{span:24}},[e("div",{staticClass:"grid-content bg-purple che_light"},[t._v("\n                      阶段黄灯时间  \n                      "),e("el-input-number",{attrs:{size:"small","controls-position":"right",min:0,max:255},model:{value:t.add_list.yellow_time,callback:function(a){t.$set(t.add_list,"yellow_time",a)},expression:"add_list.yellow_time"}}),t._v(" 秒\n                    ")],1)]),t._v(" "),e("el-col",{staticClass:"add_border",attrs:{span:24}},[e("div",{staticClass:"grid-content bg-purple che_light"},[t._v("\n                      阶段红灯时间  \n                      "),e("el-input-number",{attrs:{size:"small","controls-position":"right",min:0,max:255},model:{value:t.add_list.red_time,callback:function(a){t.$set(t.add_list,"red_time",a)},expression:"add_list.red_time"}}),t._v(" 秒\n                    ")],1)])],1),t._v(" "),e("el-col",{staticClass:"set_camera",attrs:{span:24}},[t._v("相位设置")]),t._v(" "),e("div",[e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:6}},[e("div",{staticClass:"grid-content bg-purple"},[e("el-checkbox-group",{staticClass:"set_cam_hei",on:{change:t.handlecheckListChange},model:{value:t.checkList,callback:function(a){t.checkList=a},expression:"checkList"}},t._l(t.direct,function(a,s){return e("el-checkbox",{key:s,ref:a.id,refInFor:!0,attrs:{label:a,checked:a.checked,disabled:a.judge},on:{change:function(e){return t.chosen(a,s)}}},[t._v("相位"+t._s(a.phase_num)+"-"+t._s(a.phase_name))])}),1)],1)])],1)],1)],1),t._v(" "),e("el-col",{attrs:{span:1}},[t._v(" ")]),t._v(" "),e("el-col",{attrs:{span:11}},[e("div",{staticClass:"grid-content bg-purple-light"},[e("div",{staticClass:"diagram",staticStyle:{margin:"30px auto","text-align":"right"}},[e("div",{staticStyle:{"text-align":"center",width:"370px",display:"inline-block"}},[e("div",{staticClass:"img-style"},[e("div",{staticClass:"div_n"},[e("div",{staticClass:"phase"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[2].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[1].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[0].phase_num))])]),t._v(" "),e("div",{staticClass:"phase_img"},[e("span",{staticClass:"phase_img_r"},[e("img",{staticClass:"change_img",attrs:{src:s("dpz0"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(2)},attrs:{src:s("FmuQ"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_c"},[e("img",{staticClass:"change_img",attrs:{src:s("cI4X"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(1)},attrs:{src:s("c4Uw"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_l"},[e("img",{staticClass:"change_img",attrs:{src:s("n3JR"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(0)},attrs:{src:s("Kt+i"),alt:""}})])]),t._v(" "),e("div",{staticClass:"foot_way"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[12].phase_num))]),t._v(" "),e("span",{staticClass:"foot_way_img"},[e("img",{staticClass:"change_img",attrs:{src:s("GzuU"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(12)},attrs:{src:s("fn3u"),alt:""}})])])]),t._v(" "),e("div",{staticClass:"div_w"},[e("div",{staticClass:"phase"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[5].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[4].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[3].phase_num))])]),t._v(" "),e("div",{staticClass:"phase_img"},[e("span",{staticClass:"phase_img_r"},[e("img",{staticClass:"change_img",attrs:{src:s("dpz0"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(5)},attrs:{src:s("FmuQ"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_c"},[e("img",{staticClass:"change_img",attrs:{src:s("cI4X"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(4)},attrs:{src:s("c4Uw"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_l"},[e("img",{staticClass:"change_img",attrs:{src:s("n3JR"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(3)},attrs:{src:s("Kt+i"),alt:""}})])]),t._v(" "),e("div",{staticClass:"foot_way"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[13].phase_num))]),t._v(" "),e("span",{staticClass:"foot_way_img"},[e("img",{staticClass:"change_img",attrs:{src:s("GzuU"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(13)},attrs:{src:s("fn3u"),alt:""}})])])]),t._v(" "),e("div",{staticClass:"div_s"},[e("div",{staticClass:"phase"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[8].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[7].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[6].phase_num))])]),t._v(" "),e("div",{staticClass:"phase_img"},[e("span",{staticClass:"phase_img_r"},[e("img",{staticClass:"change_img",attrs:{src:s("dpz0"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(8)},attrs:{src:s("FmuQ"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_c"},[e("img",{staticClass:"change_img",attrs:{src:s("cI4X"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(7)},attrs:{src:s("c4Uw"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_l"},[e("img",{staticClass:"change_img",attrs:{src:s("n3JR"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(6)},attrs:{src:s("Kt+i"),alt:""}})])]),t._v(" "),e("div",{staticClass:"foot_way"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[14].phase_num))]),t._v(" "),e("span",{staticClass:"foot_way_img"},[e("img",{staticClass:"change_img",attrs:{src:s("GzuU"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(14)},attrs:{src:s("fn3u"),alt:""}})])])]),t._v(" "),e("div",{staticClass:"div_e"},[e("div",{staticClass:"phase"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[11].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[10].phase_num))]),t._v(" "),e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[9].phase_num))])]),t._v(" "),e("div",{staticClass:"phase_img"},[e("span",{staticClass:"phase_img_r"},[e("img",{staticClass:"change_img",attrs:{src:s("dpz0"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(11)},attrs:{src:s("FmuQ"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_c"},[e("img",{staticClass:"change_img",attrs:{src:s("cI4X"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(10)},attrs:{src:s("c4Uw"),alt:""}})]),t._v(" "),e("span",{staticClass:"phase_img_l"},[e("img",{staticClass:"change_img",attrs:{src:s("n3JR"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(9)},attrs:{src:s("Kt+i"),alt:""}})])]),t._v(" "),e("div",{staticClass:"foot_way"},[e("span",[t._v(t._s(0===t.phaseTraffic.length?"":t.phaseTraffic[15].phase_num))]),t._v(" "),e("span",{staticClass:"foot_way_img"},[e("img",{staticClass:"change_img",attrs:{src:s("GzuU"),alt:""}}),t._v(" "),e("img",{staticClass:"change_img",class:{active:-1!=t.temp_arr.indexOf(15)},attrs:{src:s("fn3u"),alt:""}})])])])])])])])])],1),t._v(" "),e("div",{staticClass:"dialog-footer add_btn",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.dialogFormVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{staticClass:"definite_btn",on:{click:t.addfixedpart}},[t._v("确 定")])],1)],1)]}}])})],1),t._v(" "),e("el-row"),t._v(" "),e("el-row",[e("el-col",{attrs:{span:8}},[e("div",{staticClass:"grid-content bg-purple"})]),t._v(" "),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"grid-content bg-purple-light"},[e("el-pagination",{attrs:{"prev-text":"上一页","next-text":"下一页","page-size":t.pagesize,"current-page":t.currentPage,layout:" prev, pager, next, jumper, total",total:t.fixedplan_list.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)]),t._v(" "),e("el-col",{attrs:{span:8}},[e("div",{staticClass:"grid-content bg-purple"})])],1)],1)],1)},staticRenderFns:[]};var h=s("VU/8")(p,d,!1,function(t){s("oU8b"),s("hnAu"),s("G7Wt")},"data-v-100ea700",null);a.default=h.exports},G7Wt:function(t,a){},hnAu:function(t,a){},oU8b:function(t,a){}});